<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>이진수란?</title>
  <link rel="stylesheet" href="../assets/css/styles.css" />
  <style>
    .input-guide {
      background-color: #f8f9fa;
      border-left: 4px solid #007bff;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
    }

    .binary-representation {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      margin: 1rem 0;
      padding: 1rem;
      background-color: #e9ecef;
      border-radius: 4px;
    }

    .step {
      margin: 0.5rem 0;
      padding: 0.5rem;
      background-color: #f8f9fa;
      border-radius: 4px;
    }

    .step-input {
      width: 80px;
      padding: 0.25rem;
      margin-left: 0.5rem;
      border: 1px solid #ced4da;
      border-radius: 4px;
    }

    .step-input.correct {
      background-color: #d4edda;
      border-color: #c3e6cb;
    }

    .step-input.incorrect {
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }

    .result {
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 4px;
      text-align: center;
      font-weight: bold;
    }

    .converter-box {
      background-color: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      margin: 1rem 0;
    }

    .input-group {
      margin-bottom: 1rem;
    }

    .input-wrapper {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .bit-box {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .bit {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #e9ecef;
      border: 2px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .bit:hover {
      background-color: #dee2e6;
    }

    .bit.active {
      background-color: #007bff;
      color: white;
      border-color: #0056b3;
    }

    .bit.incorrect {
      background-color: #dc3545;
      color: white;
      border-color: #bd2130;
    }

    .button-group {
      display: flex;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .primary-button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .primary-button:hover {
      background-color: #0056b3;
    }

    .secondary-button {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .secondary-button:hover {
      background-color: #545b62;
    }
  </style>
</head>
<body>
  <header>
    <h1>이진수란?</h1>
    <nav>
      <ul>
        <li><a href="../index.html">홈</a></li>
        <li><a href="binary.html">이진수란?</a></li>
        <li><a href="bit.html">비트란?</a></li>
        <li><a href="text.html">문자의 디지털 표현</a></li>
        <li><a href="image.html">그림의 디지털 표현</a></li>
        <li><a href="sound.html">소리의 디지털 표현</a></li>
        <li><a href="video.html">동영상의 디지털 표현</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section>
      <h2>이진수 체계</h2>
      <p>
        이진수는 0과 1 두 개의 숫자만을 사용하여 모든 수를 표현하는 수 체계입니다.<br>
        우리가 일상에서 사용하는 십진수는 0부터 9까지의 10개의 숫자를 사용하지만,<br>
        이진수는 0과 1만을 사용하여 모든 수를 표현합니다.<br><br>
        
        이진수의 각 자리는 2의 거듭제곱을 나타냅니다.<br>
        오른쪽에서 왼쪽으로 갈수록 2의 거듭제곱이 커집니다.<br>
        예를 들어, 이진수 1011은 다음과 같이 계산됩니다:<br>
        1×2³ + 0×2² + 1×2¹ + 1×2⁰ = 8 + 0 + 2 + 1 = 11(십진수)<br>
      </p>
    </section>

    <section>
      <h2>이진수 퀴즈</h2>
      <p>이진수를 십진수로 변환하는 퀴즈를 풀어보세요!</p>
      <div class="quiz-section">
        <div class="difficulty-selector">
          <h3>난이도 선택</h3>
          <div class="difficulty-buttons">
            <button class="difficulty-btn" data-bits="3">3자리 (초급)</button>
            <button class="difficulty-btn" data-bits="4">4자리 (중급)</button>
            <button class="difficulty-btn" data-bits="5">5자리 (중상급)</button>
            <button class="difficulty-btn" data-bits="6">6자리 (상급)</button>
            <button class="difficulty-btn" data-bits="7">7자리 (최상급)</button>
          </div>
        </div>
        <button class="quiz-start-btn" onclick="startQuiz()">퀴즈 풀기</button>
      </div>
    </section>

    <!-- 퀴즈 모달 -->
    <div id="quizModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>이진수 퀴즈</h3>
          <span class="close-btn" onclick="closeQuizModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="quiz-info">
            <span id="currentDifficulty">현재 난이도: 3자리</span>
            <span id="quizScore">점수: 0</span>
          </div>
          <div id="quizQuestion" class="quiz-question"></div>
          <div class="quiz-input">
            <input type="number" id="quizAnswer" placeholder="답을 입력하세요" />
            <button onclick="checkAnswer()">정답 확인</button>
          </div>
          <div id="quizResult" class="quiz-result"></div>
        </div>
      </div>
    </div>

    <section>
      <h2>이진수 변환 게임</h2>
      <p>이진수를 십진수로 변환하는 과정을 단계별로 학습해보세요!</p>
      
      <div id="weightExplanation" class="input-guide">
        <strong>2진수의 가중치란?</strong><br>
        2진수의 각 자리에는 <strong>2의 거듭제곱</strong>이 가중치로 적용됩니다.<br>
        예를 들어, <strong>1011</strong>은 다음처럼 계산합니다:<br>
        <code>1×2³ + 0×2² + 1×2¹ + 1×2⁰ = 8 + 0 + 2 + 1 = 11</code><br>
        각 자리의 가중치를 잘 살펴보세요!
      </div>

      <div id="binaryDisplay" class="binary-representation"></div>
      <div id="stepsContainer"></div>
      
      <div class="button-group">
        <button class="primary-button" onclick="checkAnswers()">제출</button>
        <button class="secondary-button" onclick="createGame()">새 게임</button>
      </div>

      <div id="finalResult" class="result"></div>
    </section>

    <section>
      <h2>자리값으로 2진수 만들기</h2>
      <p>2진수로 변환하고 싶은 10진수를 입력하고, 자리값을 클릭하여 2진수를 만들어보세요!</p>
      
      <div class="converter-box">
        <div class="input-group">
          <label for="placeValueInput">10진수 입력 (1-1023):</label>
          <div class="input-wrapper">
            <input type="number" id="placeValueInput" placeholder="예: 25" min="1" max="1023">
            <button class="primary-button" onclick="createPlaceValueBits()">자리값 생성</button>
          </div>
        </div>

        <div id="placeValueBitBox" class="bit-box"></div>
        <div id="placeValueSumDisplay" class="result"></div>
        <div class="button-group">
          <button class="primary-button" onclick="checkPlaceValueAnswer()">제출</button>
          <button class="secondary-button" onclick="resetPlaceValueGame()">초기화</button>
        </div>
        <div id="placeValueFeedback" class="result"></div>
      </div>
    </section>
  </main>

  <script src="../assets/js/binary.js"></script>
  <script>
    // 이진수 변환 게임
    let binaryStr = "";
    let steps = [];

    function createGame() {
      steps = [];
      document.getElementById("finalResult").innerText = "";
      
      const length = Math.floor(Math.random() * 4) + 3;
      binaryStr = "";
      for (let i = 0; i < length; i++) {
        binaryStr += Math.random() < 0.5 ? "0" : "1";
      }
      if (binaryStr[0] === "0") binaryStr = "1" + binaryStr.slice(1);
      
      document.getElementById("binaryDisplay").innerText = `2진수 값: ${binaryStr}`;
      
      const container = document.getElementById("stepsContainer");
      container.innerHTML = "";
      const n = binaryStr.length;
      for (let i = 0; i < n; i++) {
        const exponent = n - 1 - i;
        const bit = binaryStr[i];
        const expected = parseInt(bit) * Math.pow(2, exponent);

        const stepDiv = document.createElement("div");
        stepDiv.className = "step";

        const label = document.createElement("span");
        label.innerHTML = `2<sup>${exponent}</sup> × ${bit} = `;

        const input = document.createElement("input");
        input.type = "number";
        input.className = "step-input";
        input.placeholder = "?";

        steps.push({ exponent, bit, expected, inputElement: input });
        stepDiv.appendChild(label);
        stepDiv.appendChild(input);
        container.appendChild(stepDiv);
      }
    }

    function checkAnswers() {
      let isAllCorrect = true;
      let total = 0;
      
      steps.forEach(step => {
        const userAnswer = parseInt(step.inputElement.value);
        step.inputElement.classList.remove("correct", "incorrect");

        if (userAnswer === step.expected) {
          step.inputElement.classList.add("correct");
        } else {
          step.inputElement.classList.add("incorrect");
          isAllCorrect = false;
        }
        total += step.expected;
      });

      const resultDiv = document.getElementById("finalResult");
      resultDiv.innerText = isAllCorrect 
        ? `✅ 모든 단계 정답! 최종 10진수 값은 ${total}입니다.` 
        : `❌ 일부 단계가 틀렸습니다. 최종 10진수 값은 ${total}입니다.`;
    }

    // 자리값 게임
    let placeValueDecimal = 0;
    let placeValueBits = [];

    function createPlaceValueBits() {
      const input = document.getElementById("placeValueInput").value;
      placeValueDecimal = parseInt(input);
      
      if (isNaN(placeValueDecimal) || placeValueDecimal < 1 || placeValueDecimal > 1023) {
        alert("1부터 1023 사이의 숫자를 입력하세요.");
        return;
      }

      placeValueBits = [];
      const bitBox = document.getElementById("placeValueBitBox");
      bitBox.innerHTML = "";

      // 필요한 비트 수 계산 (2의 거듭제곱으로 표현하기 위한 최소 비트 수)
      const maxPower = Math.floor(Math.log2(placeValueDecimal));
      
      // 각 자리값 생성
      for (let i = maxPower; i >= 0; i--) {
        const value = Math.pow(2, i);
        const div = document.createElement("div");
        div.className = "bit";
        div.innerText = `2^${i}\n(0)`;
        div.onclick = () => togglePlaceValueBit(div, i);
        bitBox.appendChild(div);
        placeValueBits.push({ element: div, active: false, value, power: i });
      }

      updatePlaceValueSum();
      document.getElementById("placeValueFeedback").innerText = "";
    }

    function togglePlaceValueBit(div, power) {
      const bit = placeValueBits.find(b => b.element === div);
      bit.active = !bit.active;
      div.classList.toggle("active", bit.active);
      div.classList.remove("incorrect");
      div.innerText = `2^${power}\n(${bit.active ? 1 : 0})`;
      updatePlaceValueSum();
      document.getElementById("placeValueFeedback").innerText = "";
    }

    function updatePlaceValueSum() {
      const sum = placeValueBits.reduce((acc, b) => acc + (b.active ? b.value : 0), 0);
      document.getElementById("placeValueSumDisplay").innerText = `현재 값의 합: ${sum}`;
    }

    function checkPlaceValueAnswer() {
      const correctBinary = placeValueDecimal.toString(2).padStart(placeValueBits.length, '0');
      let isCorrect = true;

      placeValueBits.forEach((bit, idx) => {
        const expected = correctBinary[idx] === '1';
        const user = bit.active;

        if (user !== expected) {
          bit.element.classList.add("incorrect");
          isCorrect = false;
        } else {
          bit.element.classList.remove("incorrect");
        }
      });

      const total = placeValueBits.reduce((acc, b) => acc + (b.active ? b.value : 0), 0);
      const feedback = document.getElementById("placeValueFeedback");
      
      if (isCorrect) {
        feedback.innerText = `✅ 정답입니다!`;
        feedback.style.color = "#28a745";
      } else {
        feedback.innerText = `❌ 오답입니다. 목표: ${placeValueDecimal}, 현재: ${total}`;
        feedback.style.color = "#dc3545";
      }
    }

    function resetPlaceValueGame() {
      placeValueDecimal = 0;
      placeValueBits = [];
      document.getElementById("placeValueInput").value = "";
      document.getElementById("placeValueBitBox").innerHTML = "";
      document.getElementById("placeValueSumDisplay").innerText = "";
      document.getElementById("placeValueFeedback").innerText = "";
    }

    // 초기 게임 생성
    createGame();
  </script>
</body>
</html>
